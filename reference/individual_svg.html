<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>individual_svg — individual_svg • DESpace</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="individual_svg — individual_svg"><meta name="description" content="DESpace can also be used to reveal the specific areas of the tissue affected by SVGs; i.e., spatial clusters that are particularly over/under abundant compared to the average signal.
This function can be used to identify SVGs for each individual cluster."><meta property="og:description" content="DESpace can also be used to reveal the specific areas of the tissue affected by SVGs; i.e., spatial clusters that are particularly over/under abundant compared to the average signal.
This function can be used to identify SVGs for each individual cluster."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DESpace</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/DSP.html">Differential Spatial Pattern between conditions</a></li>
    <li><a class="dropdown-item" href="../articles/SVG.html">A framework to discover Spatially Variable genes via spatial clusters</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/peicai/DESpace/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>individual_svg</h1>
      <small class="dont-index">Source: <a href="https://github.com/peicai/DESpace/blob/main/R/individual_svg.R" class="external-link"><code>R/individual_svg.R</code></a></small>
      <div class="d-none name"><code>individual_svg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>DESpace can also be used to reveal the specific areas of the tissue affected by SVGs; i.e., spatial clusters that are particularly over/under abundant compared to the average signal.
This function can be used to identify SVGs for each individual cluster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">individual_svg</span><span class="op">(</span></span>
<span>  <span class="va">spe</span>,</span>
<span>  <span class="va">cluster_col</span>,</span>
<span>  sample_col <span class="op">=</span> <span class="st">"sample_id"</span>,</span>
<span>  edgeR_y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_counts <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  min_non_zero_spots <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  filter_gene <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  replicates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-spe">spe<a class="anchor" aria-label="anchor" href="#arg-spe"></a></dt>
<dd><p>SpatialExperiment or SingleCellExperiment.</p></dd>


<dt id="arg-cluster-col">cluster_col<a class="anchor" aria-label="anchor" href="#arg-cluster-col"></a></dt>
<dd><p>Column name of spatial clusters in <code>colData(spe)</code>.</p></dd>


<dt id="arg-sample-col">sample_col<a class="anchor" aria-label="anchor" href="#arg-sample-col"></a></dt>
<dd><p>Column name of sample ids in <code>colData(spe)</code>.</p></dd>


<dt id="arg-edger-y">edgeR_y<a class="anchor" aria-label="anchor" href="#arg-edger-y"></a></dt>
<dd><p>Pre-estimated dispersion; if it's null, compute dispersion.</p></dd>


<dt id="arg-min-counts">min_counts<a class="anchor" aria-label="anchor" href="#arg-min-counts"></a></dt>
<dd><p>Minimum number of counts per sample (across all spots) for a gene to be analyzed.</p></dd>


<dt id="arg-min-non-zero-spots">min_non_zero_spots<a class="anchor" aria-label="anchor" href="#arg-min-non-zero-spots"></a></dt>
<dd><p>Minimum number of non-zero spots per sample, for a gene to be analyzed.</p></dd>


<dt id="arg-filter-gene">filter_gene<a class="anchor" aria-label="anchor" href="#arg-filter-gene"></a></dt>
<dd><p>A logical. If TRUE,
<code><a href="svg_test.html">svg_test</a></code> filters genes:
genes have to be expressed in at least 'min_non_zero_spots' spots,
and a gene requires at least 'min counts' counts per sample (across all locations).</p></dd>


<dt id="arg-replicates">replicates<a class="anchor" aria-label="anchor" href="#arg-replicates"></a></dt>
<dd><p>Single sample or multi-sample test.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>An optional parameter passed internally to bplapply.
We suggest using as many cores as the number of spatial clusters.
If unspecified, the script does not run in parallel.
Note that parallel coding performs better only when
dispersion estimations are not provided beforehand.
Moreover, parallelizing the script will increase the memory requirement;
if memory is an issue, leave 'BPPARAM' unspecified and, hence, avoid parallelization.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of results, with one result per spatial cluster in each element.
Specifically, each item in the list is a "gene_results" dataframe which contains main edgeR test results.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For every spatial cluster we test, <code>edgeR</code> would normally re-compute the dispersion estimates based on the specific design of the test.
However, this calculation represents the majority of the overall computing time.
Therefore, to speed-up calculations, we propose to use the dispersion estimates which were previously computed for the gene-level tests.
This introduces a minor approximation which, in our benchmarks, does not lead to decreased accuracy.
If you want to use pre-computed gene-level dispersion estimates, set <code>edgeR_y</code> to 'estimated_y'.
Alternatively, if you want to re-compute dispersion estimates (significantly slower, but marginally more accurate option), leave edgeR_y empty.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="top_results.html">top_results</a></code>, <code><a href="svg_test.html">svg_test</a></code>, <code><a href="FeaturePlot.html">FeaturePlot</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># load the input data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"LIBD_subset"</span>, package <span class="op">=</span> <span class="st">"DESpace"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">LIBD_subset</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class: SpatialExperiment </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dim: 500 3639 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> metadata(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> assays(2): counts logcounts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rownames(500): ENSG00000282097 ENSG00000225129 ... ENSG00000267199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ENSG00000273129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rowData names(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> colnames(3639): AAACAAGTATCTCCCA-1 AAACAATCTACTAGCA-1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   TTGTTTGTATTACACG-1 TTGTTTGTGTAAATTC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> colData names(4): array_row array_col layer_guess_reordered sample_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reducedDimNames(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mainExpName: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> altExpNames(0):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> spatialCoords names(0) :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> imgData names(0):</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load pre-computed results (obtaines via `svg_test`)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"results_svg_test"</span>, package <span class="op">=</span> <span class="st">"DESpace"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># svg_test returns of a list of 2 objects:</span></span></span>
<span class="r-in"><span><span class="co"># "gene_results": a dataframe contains main edgeR test results;</span></span></span>
<span class="r-in"><span><span class="co"># "estimated_y": a DGEList object contains the estimated common dispersion, </span></span></span>
<span class="r-in"><span><span class="co">#  which can later be used to speed-up calculation when testing individual clusters.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We visualize differential results:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_svg_test</span><span class="op">$</span><span class="va">gene_results</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         gene_id        LR   logCPM        PValue           FDR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000115756 ENSG00000115756 1073.3689 15.89723 1.204871e-228 2.855545e-226</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000054690 ENSG00000054690 1056.7744 15.48088 4.686692e-225 5.553730e-223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000111716 ENSG00000111716  752.4418 16.58993 2.894030e-159 2.286283e-157</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Individual cluster test: identify SVGs for each individual cluster</span></span></span>
<span class="r-in"><span><span class="co"># set parallel computing; we suggest using as many cores as the number of spatial clusters.</span></span></span>
<span class="r-in"><span><span class="co"># Note that parallelizing the script will increase the memory requirement;</span></span></span>
<span class="r-in"><span><span class="co"># if memory is an issue, leave 'BPPARAM' unspecified and, hence, avoid parallelization.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">results_individual_svg</span> <span class="op">&lt;-</span> <span class="fu">individual_svg</span><span class="op">(</span><span class="va">LIBD_subset</span>, </span></span>
<span class="r-in"><span>                                         edgeR_y <span class="op">=</span> <span class="va">results_svg_test</span><span class="op">$</span><span class="va">estimated_y</span>, </span></span>
<span class="r-in"><span>                                         cluster_col <span class="op">=</span> <span class="st">"layer_guess_reordered"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filter low quality genes: </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> min_counts = 20; min_non_zero_spots = 10.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The number of genes that pass filtering is237.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Pre-processing</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Start modeling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Returning results</span>
<span class="r-in"><span>                                           </span></span>
<span class="r-in"><span><span class="co"># We visualize results for the cluster 'WM'</span></span></span>
<span class="r-in"><span><span class="va">results_WM</span> <span class="op">&lt;-</span> <span class="va">results_individual_svg</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_WM</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         gene_id       LR   logCPM     logFC        PValue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000054690 ENSG00000054690 978.6555 15.48088  2.346996 7.831449e-215</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000166086 ENSG00000166086 572.4992 15.47657  1.845724 1.605722e-126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000111716 ENSG00000111716 409.7061 16.58993 -1.079196  4.247092e-91</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           FDR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000054690 1.856053e-212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000166086 1.902780e-124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ENSG00000111716  3.355203e-89</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peiying Cai, Simone Tiberi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

